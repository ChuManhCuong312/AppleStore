# TÃªn workflow hiá»ƒn thá»‹ trong GitHub Actions
name: Build and Push Docker Image

# Khi nÃ o kÃ­ch hoáº¡t workflow nÃ y
on:
  push:                # Khi Ä‘áº©y code lÃªn GitHub
    branches: [ "main" ]   # Ãp dá»¥ng cho nhÃ¡nh main

# CÃ¡c cÃ´ng viá»‡c cáº§n lÃ m
jobs:
  build:
    runs-on: ubuntu-latest     # GitHub sáº½ dÃ¹ng 1 mÃ¡y Ubuntu Ä‘á»ƒ cháº¡y

    steps:
    - name: âœ… B1 - Táº£i code tá»« GitHub
      uses: actions/checkout@v3

    - name: ðŸ›  B2 - CÃ i .NET Core SDK
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 8.0.x     # Náº¿u báº¡n dÃ¹ng .NET 6 hoáº·c 7 thÃ¬ sá»­a thÃ nh 6.0.x hay 7.0.x

    - name: ðŸ“¦ B3 - Restore thÆ° viá»‡n
      run: dotnet restore

    - name: ðŸ§± B4 - Build project
      run: dotnet build --configuration Release --no-restore

    - name: ðŸ§ª B5 - Cháº¡y Unit Test (náº¿u cÃ³)
      run: dotnet test --no-build --verbosity normal || echo "KhÃ´ng cÃ³ test nÃ o"

    - name: ðŸ” B6 - ÄÄƒng nháº­p vÃ o Docker Hub
      uses: docker/login-action@v3
      with:
        username: ${{ secrets.DOCKER_USERNAME }}  # ÄÃ£ lÆ°u á»Ÿ GitHub Secrets
        password: ${{ secrets.DOCKER_PASSWORD }}

    - name: ðŸ³ B7 - Build vÃ  Push Docker image
      uses: docker/build-push-action@v5
      with:
        context: .                       # ThÆ° má»¥c gá»‘c
        push: true                       # Cho phÃ©p Ä‘áº©y lÃªn Docker Hub
        tags: yourdockerhubuser/applestore:latest  # TÃªn image Docker

    # Láº¥y Webhook trong Render: VÃ o Render.com > App > Deploy > Manual Deploy > copy Deploy Hook URL   
    - name: ðŸš€ Trigger redeploy on Render
      run: |
        curl -X POST https://api.render.com/deploy/srv-xxxxxx?key=YOUR_KEY
